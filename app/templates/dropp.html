<form class="w-100" action="" method="post" enctype="multipart/form-data">
  {{ form.hidden_tag() }}
  {{ form.post(class_="form-control pe-4 fs-3 lh-1 border-0", rows="2", placeholder="Share your thoughts...") }}
  {% for error in form.post.errors %}
  <span style="color: red;">{{ error }}</span>
  {% endfor %}
  {{ form.image }}
  <!-- Dropzone photo START -->
  <div class="dropzone dropzone-default card shadow-none dz-clickable dropzone-previews" id="my-dropzone">
    <div class="dz-message">
      <i class="bi bi-images display-3"></i>
      <p>Drag here or click to upload photo.</p>
    </div>
    {% for error in form.image.errors %}
    <span class="help-block">{{ error }}</span>
    {% endfor %}
  </div>
  <!-- Dropzone photo END -->
  <p>{{ form.submit(class_='button-29', id='submit-all') }}</p>
</form>
<!-- Modal feed body END -->
<!-- Modal feed footer -->
<div class="modal-footer">
  <!-- Button -->
  <button type="button" class="btn btn-danger-soft me-2" data-bs-dismiss="modal">Cancel</button>
  <button type="submit" class="btn btn-success-soft">Post</button>
</div>
</div>
</div>
</div>
<!-- Modal feed footer -->
<!-- modals END -->
<script>
  var uploadUrl = "{{ url_for('main.index') }}";
</script>
<script type="text/javascript" src="{{ url_for('static', filename='js/dropzone.js') }}"></script>
<script>
  $(document).ready(function() {
    var myDropzone = new Dropzone("#my-dropzone", {
      url: uploadUrl,
      paramName: "image",
      maxFiles: 1,
      maxFilesize: 10,
      acceptedFiles: "image/*",
      addRemoveLinks: true,
      dictRemoveFile: "Remove",
      dictCancelUpload: 'Cancel', // text for cancel upload link
      dictDefaultMessage: 'Drop files here or click to upload', // default message
      autoProcessQueue: false,
      init: function() {
        var submitButton = document.querySelector("#submit-all");
        var myDropzone = this;

        submitButton.addEventListener("click", function() {
          myDropzone.processQueue(); // Tell Dropzone to process all queued files.
        });

        this.on("sending", function(file, xhr, formData) {
          // add textfield input to FormData object
          formData.append("textfield", $("#post").val());
        });

        this.on("success", function(file, response) {
          console.log(response);
        });

        this.on("error", function(file, errorMessage, xhr) {
          console.log(errorMessage);
        });
      }
    });

    $("#upload-btn").click(function() {
      $("#upload-modal").modal("show");
    });
  });
</script>
